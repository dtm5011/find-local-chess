---
import BaseLayout from '../layouts/BaseLayout.astro';
import { sanityClient } from 'sanity:client';
import { slugifyLocation } from '../lib/utils';

const query = `*[_type == "event" && !(_id in path("drafts.**")) && defined(location)]{
  "location": location,
}`;

const events = await sanityClient.fetch(query);

const allLocations = [...new Set(events.filter(event => event.location).map(event => event.location))].map(location => ({
  name: location,
  slug: slugifyLocation(location)
}));
---

<BaseLayout title="Find Local Chess - Discover Chess Events Near You">
  <div class="container">
    <section class="hero">
      <h1>Find Local Chess Events Near You</h1>
      <p>
        Find local chess events, tournaments, and meetups in your area. 
        Join our community and improve your game!
      </p>
    </section>

    <div class="grid">
      <div class="column">
        <wa-card>
          <h2 slot="header">Explore Locations</h2>
          <ul>
            {allLocations.map((location) => (
              <li>
                <a href={`/${location.slug}`}>
                  <h3>{location.name}</h3>
                </a>
              </li>
            ))}
          </ul>
        </wa-card>
      </div>

      <div class="column">
        <wa-card>
          <h2 slot="header">Get Involved</h2>
          <p>
            This is a community-driven website. Help us keep it up to date by contributing 
            event information through our easy submission form.
          </p>
          <p>
            <a href="/contribute">Learn how to contribute â†’</a>
          </p>
        </wa-card>

        <wa-card style="margin-top: 1rem;">
          <h2 slot="header">Featured Event</h2>
          <p>
            Stay tuned for our next big tournament! More details to come.
          </p>
        </wa-card>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .container {
    padding: 0 1rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .hero {
    text-align: center;
    padding: 2rem 0;
  }

  .hero h1 {
    font-size: 2rem;
    margin-bottom: 1rem;
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  wa-card {
    background-color: var(--wa-color-surface-raised);
    border: 1px solid var(--wa-color-surface-border);
    box-shadow: var(--wa-shadow-s);
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li {
    padding: 0.5rem 0;
  }

  h3 {
    margin: 0 0 0.5rem 0;
  }

  p {
    margin: 0;
  }

  /* Tablet and up */
  @media (min-width: 768px) {
    .container {
      padding: 0 2rem;
    }

    .hero {
      padding: 4rem 0;
    }

    .hero h1 {
      font-size: 3rem;
    }

    .grid {
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: var(--wa-space-l);
    }
  }
</style>