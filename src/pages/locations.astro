---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { sanityClient } from 'sanity:client';
import { slugifyLocation } from '../lib/utils';

const query = `*[_type == "event" && !(_id in path("drafts.**")) && defined(location)]{
  "location": location,
}`;

const events = await sanityClient.fetch(query);

const locations = [...new Set(events.filter(event => event.location).map(event => event.location))].map(location => ({
  name: location,
  slug: slugifyLocation(location)
}));
---

<BaseLayout title="Locations">
  <div class="container">
    <h1>Locations</h1>
    <ul>
      {locations.map(location => (
        <li>
          <a href={`/${location.slug}`}>{location.name}</a>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>